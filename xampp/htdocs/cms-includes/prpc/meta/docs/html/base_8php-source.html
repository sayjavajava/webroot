<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>PRPC: prpc/base.php Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.3 -->
<h1>prpc/base.php</h1><div class="fragment"><pre>00001 &lt;?php
00002 
00003 <span class="keywordflow">if</span> (! function_exists ('version_compare') || version_compare (phpversion (), '4.3.2', <span class="charliteral">'&lt;'</span>))
00004 {
00005     die(<span class="stringliteral">"Requires PHP 4.3.2 or higher\n"</span>);
00006 }
00007 
00008 define ('PRPC_PROT_VER', '1.0');
00009 
00010 define ('PRPC_PACK_NO', 0);
00011 define ('PRPC_PACK_GZ', 1);
00012 define ('PRPC_PACK_BZ', 2);
00013 
00014 define ('PRPC_TRACE_NONE', 0);
00015 define ('PRPC_TRACE_CALL', 1);
00016 define ('PRPC_TRACE_ARGS', 2);
00017 define ('PRPC_TRACE_FILE_CLIENT', 4);
00018 define ('PRPC_TRACE_FILE_SERVER', 8);
00019 define ('PRPC_TRACE_RESULT', 16);
00020 
00021 define ('PRPC_TRACE_FILE', PRPC_TRACE_FILE_CLIENT + PRPC_TRACE_FILE_SERVER);
00022 
<a name="l00038"></a><a class="code" href="classPrpc__Base.html">00038</a> <span class="keyword">class </span><a class="code" href="classPrpc__Base.html">Prpc_Base</a>
00039 {
00040     var $_prpc_use_pack;
00041     var $_prpc_use_debug;
00042     var $_prpc_use_trace;
00043 
00044     var $_prpc_debug;
00045 
00046     function _Prpc_Pack ($data)
00047     {
00048         <span class="keywordflow">switch</span> ($this-&gt;_prpc_use_pack)
00049         {
00050             <span class="keywordflow">case</span> PRPC_PACK_GZ:
00051                 $pack = gzcompress (serialize ($data));
00052                 <span class="keywordflow">break</span>;
00053             <span class="keywordflow">case</span> PRPC_PACK_BZ:
00054                 $pack = bzcompress (serialize ($data));
00055                 <span class="keywordflow">break</span>;
00056             <span class="keywordflow">default</span>:
00057                 $pack = serialize ($data);
00058         }
00059         <span class="keywordflow">return</span> $pack;
00060     }
00061 
00062     function _Prpc_Unpack ($pack)
00063     {
00064         <span class="keywordflow">switch</span> ($this-&gt;_prpc_use_pack)
00065         {
00066             <span class="keywordflow">case</span> PRPC_PACK_GZ:
00067                 $data = @gzuncompress ($pack);
00068                 <span class="keywordflow">break</span>;
00069             <span class="keywordflow">case</span> PRPC_PACK_BZ:
00070                 $data = @bzdecompress ($pack);
00071                 <span class="keywordflow">break</span>;
00072             <span class="keywordflow">default</span>:
00073                 $data = $pack;
00074         }
00075 
00076         <span class="keywordflow">return</span> unserialize ($data);
00077     }
00078 
00079     function _Prpc_Get_Host ()
00080     {
00081         <span class="keywordflow">if</span> (! isset ($this-&gt;_prpc_get_host_cache))
00082         {
00083             ob_start ();
00084             $rc = system ('hostname -f');
00085             $ob = trim (ob_get_clean ());
00086             $this-&gt;_prpc_get_host_cache = ($rc === FALSE ? $_SERVER['SERVER_NAME'] : $ob);
00087         }
00088         <span class="keywordflow">return</span> $this-&gt;_prpc_get_host_cache;
00089     }
00090 
00091     function _Debug ($msg, $type = NULL)
00092     {
00093         <span class="keywordflow">if</span> (@$_SERVER [<span class="stringliteral">"HTTP_X_PRPC_DEPTH"</span>])
00094         {
00095             echo $msg, <span class="stringliteral">"\n"</span>;
00096         }
00097         <span class="keywordflow">else</span>
00098         {
00099             $this-&gt;_prpc_debug .= $msg.<span class="stringliteral">"\n"</span>;
00100         }
00101     }
00102 
00103     function _Trace ($frame, $type, $opt = NULL)
00104     {
00105         <span class="keywordflow">if</span> (($type = ($this-&gt;_prpc_use_trace &amp; $type)))
00106         {
00107             $btrace = debug_backtrace ();
00108             $host = $this-&gt;_Prpc_Get_Host ();
00109             $level = number_format (@$_SERVER ['HTTP_X_PRPC_DEPTH']);
00110 
00111             <span class="keywordflow">switch</span> ($type)
00112             {
00113                 <span class="keywordflow">case</span> PRPC_TRACE_ARGS:
00114                     ob_start (); print_r ($btrace[$frame]['args']); $args = ob_get_clean ();
00115                     $this-&gt;_Debug (<span class="stringliteral">"\nTRACE:"</span>.$level.<span class="stringliteral">":PRPC_ARGS @ "</span>.$host.<span class="stringliteral">":"</span>.$btrace[$frame]['file'].<span class="stringliteral">", line = "</span>.$btrace[$frame]['line'].<span class="stringliteral">", method = "</span>.ucwords($opt-&gt;method).<span class="stringliteral">"(), target = "</span>.$this-&gt;_prpc_url.<span class="stringliteral">"\n"</span>.$args.<span class="stringliteral">"\n"</span>);
00116                     <span class="keywordflow">break</span>;
00117 
00118                 <span class="keywordflow">case</span> PRPC_TRACE_RESULT:
00119                     ob_start (); print_r ($opt['result']); $res = ob_get_clean ();
00120                     $this-&gt;_Debug (<span class="stringliteral">"\nTRACE:"</span>.$level.<span class="stringliteral">":PRPC_RESULT @ "</span>.$host.<span class="stringliteral">":"</span>.$btrace[$frame]['file'].<span class="stringliteral">", line = "</span>.$btrace[$frame]['line'].<span class="stringliteral">", method = "</span>.ucwords($opt['method']).<span class="stringliteral">"(), target = "</span>.$this-&gt;_prpc_url.<span class="stringliteral">"\n"</span>.$res.<span class="stringliteral">"\n"</span>);
00121                     <span class="keywordflow">break</span>;
00122 
00123                 <span class="keywordflow">case</span> PRPC_TRACE_CALL:
00124                     $this-&gt;_Debug (<span class="stringliteral">"\nTRACE:"</span>.$level.<span class="stringliteral">":PRPC_CALL @ "</span>.$host.<span class="stringliteral">":"</span>.$btrace[$frame]['file'].<span class="stringliteral">", line = "</span>.$btrace[$frame]['line'].<span class="stringliteral">", method = "</span>.ucwords($opt-&gt;method).<span class="stringliteral">"(), target = "</span>.$this-&gt;_prpc_url);
00125                     <span class="keywordflow">break</span>;
00126 
00127                 <span class="keywordflow">case</span> PRPC_TRACE_FILE_SERVER:
00128                     $this-&gt;_Debug (<span class="stringliteral">"\nTRACE:"</span>.$level.<span class="stringliteral">":PRPC_SERVER @ "</span>.$host.<span class="stringliteral">":"</span>.$btrace[$frame]['file'].<span class="stringliteral">", line = "</span>.$btrace[$frame]['line'].<span class="stringliteral">", method = "</span>.ucwords($opt-&gt;method).<span class="stringliteral">"()"</span>);
00129                     <span class="keywordflow">break</span>;
00130 
00131                 <span class="keywordflow">case</span> PRPC_TRACE_FILE_CLIENT:
00132                     if (! $level)
00133                         $this-&gt;_Debug (<span class="stringliteral">"\nTRACE:"</span>.$level.<span class="stringliteral">":PRPC_CLIENT @ "</span>.$host.<span class="stringliteral">":"</span>.$btrace[$frame]['file'].<span class="stringliteral">", line = "</span>.$btrace[$frame]['line']);
00134                     <span class="keywordflow">break</span>;
00135             }
00136         }
00137     }
00138 }
00139 ?&gt;
</pre></div>	<hr size="1">
	<address style="align: right;">
		<small>Generated on Fri Jul 18 15:03:44 2003</small>
	</address>
</body>
</html>
